1
00:00:01,033 --> 00:00:03,510
Thanks to our mutation.

2
00:00:03,510 --> 00:00:05,807
We are storing the token in UX,

3
00:00:05,807 --> 00:00:07,450
and that means that of course,

4
00:00:07,450 --> 00:00:10,080
we can also access it from anywhere in this app

5
00:00:10,080 --> 00:00:11,840
whenever we need it.

6
00:00:11,840 --> 00:00:15,420
And I mentioned that we would need to add that token

7
00:00:15,420 --> 00:00:16,583
to outgoing requests.

8
00:00:16,583 --> 00:00:19,652
If these requests target and points,

9
00:00:19,652 --> 00:00:23,003
resources on Firebase that are protected.

10
00:00:24,010 --> 00:00:26,890
So therefore we probably should add some getters here

11
00:00:27,730 --> 00:00:29,510
in our auth module,

12
00:00:29,510 --> 00:00:30,680
a token getter,

13
00:00:30,680 --> 00:00:32,100
for example,

14
00:00:32,100 --> 00:00:35,203
where we simply returned state token.

15
00:00:36,480 --> 00:00:39,610
And now we can use this in the other modules.

16
00:00:39,610 --> 00:00:43,610
When we send requests to protected URLs.

17
00:00:43,610 --> 00:00:46,480
For example, for coaches under actions.

18
00:00:46,480 --> 00:00:48,980
When we register a coach,

19
00:00:48,980 --> 00:00:51,980
here this resource is currently not accessible.

20
00:00:51,980 --> 00:00:53,760
If we're not authenticated,

21
00:00:53,760 --> 00:00:55,920
well that's something we can change.

22
00:00:55,920 --> 00:00:59,327
If you send a request to your Firebase realtime database,

23
00:00:59,327 --> 00:01:02,100
you can add a off token

24
00:01:02,100 --> 00:01:05,420
by adding a query parameter to this URL.

25
00:01:05,420 --> 00:01:08,560
That's something you can read in the official Firebase docs.

26
00:01:08,560 --> 00:01:11,050
Here we can add the auth query parameter

27
00:01:11,050 --> 00:01:14,780
after a question mark at the end of this URL

28
00:01:14,780 --> 00:01:17,250
and set the value equal to our token

29
00:01:17,250 --> 00:01:19,933
because that token is just a string in the end.

30
00:01:21,140 --> 00:01:23,620
So now here we need our token, of course,

31
00:01:23,620 --> 00:01:26,360
so we can get debt by accessing

32
00:01:26,360 --> 00:01:27,690
context,

33
00:01:27,690 --> 00:01:28,860
getters,

34
00:01:28,860 --> 00:01:30,340
token,

35
00:01:30,340 --> 00:01:31,690
just like that.

36
00:01:31,690 --> 00:01:35,320
And then we can add our token to this URL

37
00:01:37,440 --> 00:01:39,733
with that registering should be possible.

38
00:01:41,260 --> 00:01:44,350
We already are also using our user ID,

39
00:01:44,350 --> 00:01:47,050
which is now our real user ID

40
00:01:47,050 --> 00:01:48,710
generated by Firebase.

41
00:01:48,710 --> 00:01:50,643
So that's not also an improvement.

42
00:01:52,520 --> 00:01:54,110
Now for

43
00:01:54,110 --> 00:01:55,210
requests

44
00:01:55,210 --> 00:01:56,260
under actions,

45
00:01:56,260 --> 00:01:58,090
it's fetch requests,

46
00:01:58,090 --> 00:01:59,050
which doesn't work.

47
00:01:59,050 --> 00:02:00,810
If we don't have a token.

48
00:02:00,810 --> 00:02:02,810
So here we'll do the same thing.

49
00:02:02,810 --> 00:02:05,760
Get our token with context.

50
00:02:05,760 --> 00:02:07,200
Actually we should use

51
00:02:07,200 --> 00:02:11,560
rootgetters.token,

52
00:02:11,560 --> 00:02:13,780
and also under coaches.

53
00:02:13,780 --> 00:02:15,940
That should be rootgetters

54
00:02:15,940 --> 00:02:18,850
because we access this on our rootstore,

55
00:02:18,850 --> 00:02:20,720
not on this module specifically,

56
00:02:20,720 --> 00:02:21,770
but on our rootstore.

57
00:02:22,860 --> 00:02:25,463
So context rootgetters token it is.

58
00:02:27,460 --> 00:02:30,057
And then add debt token here as well

59
00:02:30,057 --> 00:02:33,863
with question mark of equals plus token.

60
00:02:35,840 --> 00:02:36,673
Now with that,

61
00:02:36,673 --> 00:02:38,400
if we save all of that,

62
00:02:38,400 --> 00:02:40,380
if I go to requests and reload,

63
00:02:40,380 --> 00:02:43,690
we still fail because we're not logged in yet.

64
00:02:43,690 --> 00:02:46,880
At the moment we need to log in manually all the time

65
00:02:46,880 --> 00:02:48,740
will soon change this though,

66
00:02:48,740 --> 00:02:51,850
but let's go back to slash off by entering this

67
00:02:51,850 --> 00:02:53,293
and then log in.

68
00:02:55,340 --> 00:02:57,120
And then go to requests.

69
00:02:57,120 --> 00:03:00,560
And now you see, we don't find messages for us,

70
00:03:00,560 --> 00:03:01,660
which makes sense,

71
00:03:01,660 --> 00:03:03,470
but we don't get an error.

72
00:03:03,470 --> 00:03:05,100
If I go to all the coaches,

73
00:03:05,100 --> 00:03:07,810
I can also register as a coach now.

74
00:03:07,810 --> 00:03:09,513
And if I give this a try,

75
00:03:11,120 --> 00:03:14,940
I'm a web developer and freelancer,

76
00:03:14,940 --> 00:03:18,483
let me boost your career,

77
00:03:23,490 --> 00:03:25,630
And click register.

78
00:03:25,630 --> 00:03:27,640
This also seems to work.

79
00:03:27,640 --> 00:03:29,090
And if I reload now,

80
00:03:29,090 --> 00:03:30,770
this data is still there

81
00:03:30,770 --> 00:03:33,440
because it now ended up in the real time database

82
00:03:33,440 --> 00:03:34,540
on Firebase

83
00:03:34,540 --> 00:03:36,240
here under coaches.

84
00:03:36,240 --> 00:03:40,120
We now see that real user ID has a note for the coach data,

85
00:03:40,120 --> 00:03:41,163
I just to added.

86
00:03:42,110 --> 00:03:44,150
So that's great,

87
00:03:44,150 --> 00:03:46,870
with that we now successfully attached to token

88
00:03:46,870 --> 00:03:48,480
to outgoing requests,

89
00:03:48,480 --> 00:03:50,363
which is a huge step forward.

90
00:03:52,340 --> 00:03:55,740
Now we can start working on the UI a little bit.

91
00:03:55,740 --> 00:03:57,810
For example, at the moment we manually

92
00:03:57,810 --> 00:04:01,190
have to enter a slash off to reach this page,

93
00:04:01,190 --> 00:04:04,320
would be nicer if we had an option here in the navigation,

94
00:04:04,320 --> 00:04:07,700
or maybe here instead of register as coach,

95
00:04:07,700 --> 00:04:09,260
if we need to be logged in,

96
00:04:09,260 --> 00:04:10,940
in order to register,

97
00:04:10,940 --> 00:04:13,400
we should probably not even show this button

98
00:04:13,400 --> 00:04:15,290
if we're not logged in.

99
00:04:15,290 --> 00:04:16,880
So as a next step,

100
00:04:16,880 --> 00:04:18,262
we're going to update that UI.

